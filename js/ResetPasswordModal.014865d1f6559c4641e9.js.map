{"version":3,"sources":["webpack:///./App/Containers/ResetPasswordModal/reset-password-modal.jsx"],"names":["actions","password","console","error","error_msg","setStatus","reset_complete","new_password","handleSubmit","verification_code","api_request","WS","resetPassword","response","onResetComplete","min_password_length","resetInitialValues","errors","isSubmitting","handleChange","status","values","className","handleBlur","touched","i18n","Component","ResetPassword","propTypes","ResetPasswordModal","toggleResetPasswordModal","enableApp","is_loading","disableApp","func","PropTypes","is_visible","client"],"mappings":"4wCAuBQA,aAAoBC,MAEpB,G,4FACA,MAAe,GAEXC,UAAQC,UAAMC,OAAd,2BACAJ,KAAQK,UAAU,GA8CV,OA7CR,mD,iCAGJL,EAAQK,eAAU,GAAEC,YAAgB,CAApC,c,EAWIC,O,QAJRC,M,QAAoC,EACxBC,WACFC,UAAW,IAMjBC,EAAGC,UAAcF,CAAjB,mFAAmC,6DAC/B,EAAIG,CACA,iBACH,aAFD,EAEO,SACH,kBAAKC,G,0BAJsB,e,EAAA,G,EAAA,mFAAnC,O,sBAAA,oD,0BAUY,KAAZ,EACMC,U,mBAIL,M,kOAfkC,K,qCAyBiBX,OAF5C,aAAC,EAAD,gBADJ,IACI,2BACI,YAAeY,GACyBZ,GAExC,E,UAoFd,O,mOA1IFU,E,KAwDgCG,G,EAAAA,EAAf,qCAAwCC,yBAAxC,UAAsDC,kBAAtD,IAAoEC,kBAApE,eACG,EAGiB,cAAU,CAAf,gBACI,EAAG,UAAU,IACC,4BAAV,SAEJ,oBAAG,SAAS,GAAZ,IACI,IAAC,WACG,IAAiB,OAPhC,EAYG,SAAK,EAAU,UACX,iBAAG,EAAU,eACT,WAAU,yBAAkB,uFADhC,UAGA,sCAAU,kBAAU,KAApB,UACI,2BACI,IAAOC,cAAOpB,IADlB,CAEI,kBAAeA,oCAEf,kBAAC,KACGqB,UAAU,2BACV,IAAK,cAFT,KAGI,kBAAgB,kDAChB,IAAUH,cAJd,OAKI,UAAQI,sCACR,IAAOC,cAAQvB,IAAR,CACP,UAAOoB,2BACP,kBAAc,IARlB,CASI,kBAAQ,2BAlBxB,IAsBI,0BAAGC,UAAU,4BACRF,IAAM,cACH,KACI,iBACA,MAAM,EAAE,sBAAEhB,kBAAkBA,KAApB,2CAHf,KAMG,WACI,aAAAqB,EAAA,+BARZ,SAaA,EACI,SAA+C,6BAAF,MADjD,WAEI,gBAFJ,OAGI,gBAEA,kBAAC,IAAD,CAAU,qCAxClB,EAff,iCARb,kCA0EH,Q,gDA3H6BC,kB,2IA8HlCC,UAAcC,IAAY,uBACZ,iCADY,4BAGtBnB,cAHJ,wC,uBAMMoB,kBAAqB,mC,2BAMvBC,E,CAEA,eAGQ,EAAU,UAFd,CAGIC,UAAS,IAAEA,KACX,eAAYC,SAJhB,kBAMI,IAAC,QAGG,MAAWD,YAHf,IAPR,cARJ,e,eAwBAF,EAAmBD,aACfK,EAAoCC,EADT,kBAE3BH,EAF2B,2BAG3BC,WAA0BG,cAHC,KAI3BC,WAA0BD,EAC1BL,aACArB,YANJ,cASA,kBACI,kDAAqB,MAIjBuB,EAA6BA,UAJZ,CAKjBF,oBACArB,cAA0B4B,KANT,WAArB,SADW,WASbR,IATF,K","file":"js/ResetPasswordModal.014865d1f6559c4641e9.js","sourcesContent":["import React                 from 'react';\nimport PropTypes             from 'prop-types';\nimport classNames            from 'classnames';\nimport {\n    Formik,\n    Form }                   from 'formik';\nimport {\n    Button,\n    Dialog,\n    PasswordInput,\n    PasswordMeter }          from 'deriv-components';\nimport Localize              from 'App/Components/Elements/localize.jsx';\nimport { localize }          from 'App/i18n';\nimport { connect }           from 'Stores/connect';\nimport { validPassword }     from 'Utils/Validator/declarative-validation-rules';\nimport { redirectToLogin }   from '_common/base/login';\nimport { requestLogout, WS } from 'Services/index';\n\nconst resetInitialValues = { password: '' };\n\nclass ResetPassword extends React.Component {\n    onResetComplete = (error_msg, actions) => {\n        actions.setSubmitting(false);\n        actions.resetForm({ password: '' });\n        // Error would be returned on invalid token (and the like) cases.\n        // TODO: Proper error handling (currently we have no place to put the message)\n        if (error_msg) {\n            // eslint-disable-next-line no-console\n            console.error(error_msg);\n            actions.setStatus({ error_msg });\n            return;\n        }\n\n        actions.setStatus({ reset_complete: true });\n\n        requestLogout().then(() => {\n            redirectToLogin();\n        });\n    };\n\n    handleSubmit = (values, actions) => {\n        const { verification_code } = this.props;\n        const api_request = {\n            reset_password: 1,\n            new_password  : values.password,\n            verification_code,\n        };\n\n        WS.resetPassword(api_request).then(async response => {\n            if (response.error) {\n                this.onResetComplete(response.error.message, actions);\n            } else {\n                this.onResetComplete(null, actions);\n            }\n        });\n    }\n\n    validateReset = (values) => {\n        const errors = {};\n        const min_password_length = 6;\n\n        if (values.password && (values.password.length < min_password_length || !validPassword(values.password))) {\n            errors.password = true;\n        }\n\n        return errors;\n    };\n\n    render() {\n        return (\n            <div className='reset-password'>\n                <Formik\n                    initialValues={resetInitialValues}\n                    initialStatus={{ reset_complete: false, error_msg: '' }}\n                    validate={this.validateReset}\n                    onSubmit={this.handleSubmit}\n                >\n                    {({ handleBlur, errors, values, touched, isSubmitting, handleChange, status }) => (\n                        <Form>\n                            <React.Fragment>\n                                {status.reset_complete ? (\n                                    <div className='reset-password__password-selection'>\n                                        <p className='reset-password__heading'>\n                                            <Localize i18n_default_text='Your password has been changed' />\n                                        </p>\n                                        <p className='reset-password__subtext'>\n                                            <Localize\n                                                i18n_default_text='We will now redirect you to the login page.'\n                                            />\n                                        </p>\n                                    </div>\n                                ) : (\n                                    <div className='reset-password__password-selection'>\n                                        <p className='reset-password__heading'>\n                                            <Localize i18n_default_text='Choose a new password' />\n                                        </p>\n                                        <fieldset className='reset-password__fieldset'>\n                                            <PasswordMeter\n                                                input={values.password}\n                                                error={touched.password && errors.password}\n                                            >\n                                                <PasswordInput\n                                                    className='reset-password__password-field'\n                                                    name='password'\n                                                    label={localize('Create a password')}\n                                                    onChange={handleChange}\n                                                    onBlur={handleBlur}\n                                                    error={touched.password && errors.password}\n                                                    value={values.password}\n                                                    data-lpignore='true'\n                                                    required\n                                                />\n                                            </PasswordMeter>\n                                        </fieldset>\n                                        <p className='reset-password__subtext'>\n                                            {status.error_msg ? (\n                                                <Localize\n                                                    i18n_default_text='{{error_msg}}'\n                                                    values={{ error_msg: status.error_msg }}\n                                                />\n                                            ) : (\n                                                <Localize\n                                                    i18n_default_text='Strong passwords contain at least 6 characters, combine uppercase and lowercase letters, numbers, and symbols.'\n                                                />\n                                            )}\n                                        </p>\n\n                                        <Button\n                                            className={classNames('reset-password__btn', { 'reset-password__btn--disabled': !values.password || errors.password || isSubmitting })}\n                                            type='submit'\n                                            is_disabled={!values.password || errors.password || isSubmitting}\n                                        >\n                                            <Localize i18n_default_text='Reset my password' />\n                                        </Button>\n                                    </div>\n                                )}\n\n                            </React.Fragment>\n                        </Form>\n                    )}\n                </Formik>\n            </div>\n        );\n    }\n}\n\nResetPassword.propTypes = {\n    enableApp        : PropTypes.func,\n    isModalVisible   : PropTypes.func,\n    verification_code: PropTypes.string,\n};\n\nconst ResetPasswordModal = ({\n    enableApp,\n    disableApp,\n    is_loading,\n    is_visible,\n    verification_code,\n    toggleResetPasswordModal,\n}) => {\n    return (\n        <Dialog\n            is_visible={is_visible}\n            disableApp={disableApp}\n            enableApp={enableApp}\n            is_loading={is_loading}\n        >\n            <ResetPassword\n                verification_code={verification_code}\n                isModalVisible={toggleResetPasswordModal}\n                enableApp={enableApp}\n            />\n        </Dialog>\n    );\n};\n\nResetPasswordModal.propTypes = {\n    disableApp              : PropTypes.func,\n    enableApp               : PropTypes.func,\n    is_loading              : PropTypes.bool,\n    is_visible              : PropTypes.bool,\n    toggleResetPasswordModal: PropTypes.func,\n    verification_code       : PropTypes.string,\n};\n\nexport default connect(\n    ({ ui, client }) => ({\n        is_visible              : ui.is_reset_password_modal_visible,\n        enableApp               : ui.enableApp,\n        disableApp              : ui.disableApp,\n        is_loading              : ui.is_loading,\n        toggleResetPasswordModal: ui.toggleResetPasswordModal,\n        verification_code       : client.verification_code.reset_password,\n    }),\n)(ResetPasswordModal);\n"],"sourceRoot":""}